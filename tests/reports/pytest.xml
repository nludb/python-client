<?xml version="1.0" encoding="utf-8"?><testsuites><testsuite name="pytest" errors="0" failures="1" skipped="0" tests="1" time="61.330" timestamp="2022-05-26T00:04:52.415762" hostname="Steamship.local"><testcase classname="tests.tests.plugin.integration.test_e2e_trainable_tagger" name="test_e2e_trainable_tagger_lambda_training" time="61.190"><failure message="steamship.base.error.SteamshipError: The file at signed URL https://steamship-spaces-staging.s3.us-west-2.amazonaws.com/spaces/658B0ABB-DA53-496D-9FE5-E0631CA5DEF2/C014470D-490A-4201-8934-5E62AF77AFCD/pluginData/882C33F9-B3DA-4E74-A536-D44934485473/default.zip?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=ASIAYRUKYC4IP4DKWJMM%2F20220526%2Fus-west-2%2Fs3%2Faws4_request&amp;X-Amz-Date=20220526T040552Z&amp;X-Amz-Expires=86400&amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjELT%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIBN551FSErcN8L55elYbUWEkYb9hIlAx%2FQ6y%2FxiFBtpRAiEApCj8C8hukI4l6Rela%2BrYyyjUOH9NeSgLyJqhf4TlQ20qgAQInf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw1ODc2Mjc3NjM0NzIiDBNtH3xiU9kWbdsXgCrUA6hViy71xwCfWyCor%2B21IfT4Ktcu5rmpiS4P6SSlqHoeOHTdvWrDkA%2F3qCnCCCsXjKQ99jwFLIXbUqxADXd3yaaLhOtAcfg4g%2BLurGGUo28NUL2q7afH%2BUt%2FZQeNGFmSka5%2Bucehs8Z%2Fb3DQyaxIZHqHe%2FrszodTChFt2cgGosdEPzitvC13%2FRGR0p%2FSxGmWZ%2BISiPg1BMoKATM9CxTPzwaWaR%2BVChatWzF7N240P6J4LKwqmkHeFAgDe79SZ3DAkAwNGXHn8xY015%2F4aEBBO7iFxgOEICiGjvCxT%2FYHKpk74DP%2F6BSZsaY5tzz2HFTKaw3g4V9kVXaVK9L0YXiZr4q0rq9deouXJFslCCnGGmWbSZ39QzQe9zRKEXuKmgRxtZqvI0Ruck%2Fz9Y7gwmk9PiT1QfXnbIexe4LrsuRj%2Ft8QfelxuktBICmksje06xLpWhLlREa3BJHlLYq%2FaCNBKDSpHqOZKWP81ogR6dLtzu%2BAvmvIcFxiz14IBdQSHRu6U1UhghuZx286Zvhq5p3JAQtTmqU1y7xZdDusKpqtJ7qf3pHNQmMpe4%2BbWWkOCakYVB3VKxm2uPHO0vHOcmYz9XUQx58BSkKtaCd91WQbMQMqDa7uwzCp97uUBjqlAUjsb8ClOlfs2xR4Bgj%2BRAO0XKtxUxetty6sBxVPYRWF0JVDXJUqXyQj3t3z0563W9OccasAH5gFwrez%2Fpg9NmZ62jTdLBD9yuQ%2Br2Dfy8Ln18BPEKrCnRRr07fh4b9XCe2mUVGaaCvonn%2Fhcan%2F0qU%2BJlLNopGsgaDJ3JvgIJMC8N054r5bPvaTNwnSa4sIRQU9van2AqdgZHTdcj5HUjAasS%2F3sQ%3D%3D&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=323b336c6a892b8465bf349e282dbc7837bac195538a410eedc3dc557f43cd93 did not exist. HTTP 404. Content: &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#10;&lt;Error&gt;&lt;Code&gt;NoSuchKey&lt;/Code&gt;&lt;Message&gt;The specified key does not exist.&lt;/Message&gt;&lt;Key&gt;spaces/658B0ABB-DA53-496D-9FE5-E0631CA5DEF2/C014470D-490A-4201-8934-5E62AF77AFCD/pluginData/882C33F9-B3DA-4E74-A536-D44934485473/default.zip&lt;/Key&gt;&lt;RequestId&gt;2DES3TF5JC5XMVPY&lt;/RequestId&gt;&lt;HostId&gt;JDJOZsOLMYugw4RSbYL9E14L+HkQ7lVGl4fQJhnqj/Rxt2HQE99FLsyVtv81YBcM1cgcyOf1Gac=&lt;/HostId&gt;&lt;/Error&gt;">client = Steamship(config=Configuration(api_key='2316C7EF-69BF-41E5-B315-33143129A483', api_base='https://api.staging.steamship...ging.steamship.com/', space_id='C014470D-490A-4201-8934-5E62AF77AFCD', space_handle=None, profile=None), tasks=Tasks())

    def test_e2e_trainable_tagger_lambda_training(client: Steamship):
    
        version_config_template = dict(
            text_column=dict(type="string"),
            tag_columns=dict(type="string"),
            tag_kind=dict(type="string"),
        )
        instance_config = dict(text_column="Message", tag_columns="Category", tag_kind="Intent")
    
        exporter_plugin_r = PluginInstance.create(
            client=client,
            handle=EXPORTER_HANDLE,
            plugin_handle=EXPORTER_HANDLE,
            upsert=True,
        )
        assert exporter_plugin_r.data is not None
        exporter_plugin = exporter_plugin_r.data
        assert exporter_plugin.handle is not None
    
        csv_blockifier_path = PLUGINS_PATH / "blockifiers" / "csv_blockifier.py"
        trainable_tagger_path = PLUGINS_PATH / "taggers" / "plugin_trainable_tagger.py"
    
        # Make a blockifier which will generate our trainable corpus
        with deploy_plugin(
            client,
            csv_blockifier_path,
            "blockifier",
            version_config_template=version_config_template,
            instance_config=instance_config,
        ) as (plugin, version, instance):
            with upload_file(client, "utterances.csv") as file:
                assert len(file.refresh().data.blocks) == 0
                # Use the plugin we just registered
                file.blockify(plugin_instance=instance.handle).wait()
                assert len(file.refresh().data.blocks) == 5
    
                # Now make a trainable tagger to train on those tags
                with deploy_plugin(
                    client, trainable_tagger_path, "tagger", training_platform=HostingType.LAMBDA
                ) as (tagger, tagger_version, tagger_instance):
                    # Now train the plugin
                    training_request = TrainingParameterPluginInput(
                        plugin_instance=tagger_instance.handle,
                        export_request=ExportPluginInput(
                            plugin_instance=EXPORTER_HANDLE, type="corpus", handle="default"
                        ),
                        training_params=dict(
                            keyword_list=KEYWORDS  # This is a key defined by the test model we're training
                        ),
                    )
    
                    train_result = tagger_instance.train(training_request)
                    train_result.wait()
    
                    # At this point, the PluginInstance will have written a parameter file to disk. We should be able to
                    # retrieve it since we know that it is tagged as the `default`.
    
                    checkpoint = ModelCheckpoint(
                        client=client,
                        handle="default",
                        plugin_instance_id=tagger_instance.id,
                    )
&gt;                   checkpoint_path = checkpoint.download_model_bundle()

tests/plugin/integration/test_e2e_trainable_tagger.py:84: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../src/steamship/plugin/outputs/model_checkpoint.py:111: in download_model_bundle
    download_from_signed_url(download_resp.data.signedUrl, to_file=self.archive_path_on_disk())
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

url = 'https://steamship-spaces-staging.s3.us-west-2.amazonaws.com/spaces/658B0ABB-DA53-496D-9FE5-E0631CA5DEF2/C014470D-490A...%2F3sQ%3D%3D&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=323b336c6a892b8465bf349e282dbc7837bac195538a410eedc3dc557f43cd93'
to_file = PosixPath('/var/folders/lg/s9f7mp_90v768ds8bsjq_sdm0000gn/T/tmplxrr8c7y/default.zip')

    def download_from_signed_url(url: str, to_file: Path = None) -&gt; Path:
        """
        Downloads the Signed URL to the filename `desired_filename` in a temporary directory on disk.
        """
        url = apply_localstack_url_fix(url)
        logging.info(f"Downloading: {url} to {to_file} in a temporary directory")
    
        resp = requests.get(url)
        if resp.status_code != 200:
            # TODO: At least Localstack seend to reply with HTTP 200 even if the file isn't found!
            # The full response contains:
            # &lt;Error&gt;
            #     &lt;Code&gt;NoSuchKey&lt;/Code&gt;
            # So we **could** check the response text even in the event of 200 but that seems wrong..
            if "&lt;Code&gt;NoSuchKey&lt;/Code&gt;" in resp.text:
&gt;               raise SteamshipError(
                    message=f"The file at signed URL {url} did not exist. HTTP {resp.status_code}. Content: {resp.text}"
                )
E               steamship.base.error.SteamshipError: The file at signed URL https://steamship-spaces-staging.s3.us-west-2.amazonaws.com/spaces/658B0ABB-DA53-496D-9FE5-E0631CA5DEF2/C014470D-490A-4201-8934-5E62AF77AFCD/pluginData/882C33F9-B3DA-4E74-A536-D44934485473/default.zip?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=ASIAYRUKYC4IP4DKWJMM%2F20220526%2Fus-west-2%2Fs3%2Faws4_request&amp;X-Amz-Date=20220526T040552Z&amp;X-Amz-Expires=86400&amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjELT%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIBN551FSErcN8L55elYbUWEkYb9hIlAx%2FQ6y%2FxiFBtpRAiEApCj8C8hukI4l6Rela%2BrYyyjUOH9NeSgLyJqhf4TlQ20qgAQInf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw1ODc2Mjc3NjM0NzIiDBNtH3xiU9kWbdsXgCrUA6hViy71xwCfWyCor%2B21IfT4Ktcu5rmpiS4P6SSlqHoeOHTdvWrDkA%2F3qCnCCCsXjKQ99jwFLIXbUqxADXd3yaaLhOtAcfg4g%2BLurGGUo28NUL2q7afH%2BUt%2FZQeNGFmSka5%2Bucehs8Z%2Fb3DQyaxIZHqHe%2FrszodTChFt2cgGosdEPzitvC13%2FRGR0p%2FSxGmWZ%2BISiPg1BMoKATM9CxTPzwaWaR%2BVChatWzF7N240P6J4LKwqmkHeFAgDe79SZ3DAkAwNGXHn8xY015%2F4aEBBO7iFxgOEICiGjvCxT%2FYHKpk74DP%2F6BSZsaY5tzz2HFTKaw3g4V9kVXaVK9L0YXiZr4q0rq9deouXJFslCCnGGmWbSZ39QzQe9zRKEXuKmgRxtZqvI0Ruck%2Fz9Y7gwmk9PiT1QfXnbIexe4LrsuRj%2Ft8QfelxuktBICmksje06xLpWhLlREa3BJHlLYq%2FaCNBKDSpHqOZKWP81ogR6dLtzu%2BAvmvIcFxiz14IBdQSHRu6U1UhghuZx286Zvhq5p3JAQtTmqU1y7xZdDusKpqtJ7qf3pHNQmMpe4%2BbWWkOCakYVB3VKxm2uPHO0vHOcmYz9XUQx58BSkKtaCd91WQbMQMqDa7uwzCp97uUBjqlAUjsb8ClOlfs2xR4Bgj%2BRAO0XKtxUxetty6sBxVPYRWF0JVDXJUqXyQj3t3z0563W9OccasAH5gFwrez%2Fpg9NmZ62jTdLBD9yuQ%2Br2Dfy8Ln18BPEKrCnRRr07fh4b9XCe2mUVGaaCvonn%2Fhcan%2F0qU%2BJlLNopGsgaDJ3JvgIJMC8N054r5bPvaTNwnSa4sIRQU9van2AqdgZHTdcj5HUjAasS%2F3sQ%3D%3D&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=323b336c6a892b8465bf349e282dbc7837bac195538a410eedc3dc557f43cd93 did not exist. HTTP 404. Content: &lt;?xml version="1.0" encoding="UTF-8"?&gt;
E               &lt;Error&gt;&lt;Code&gt;NoSuchKey&lt;/Code&gt;&lt;Message&gt;The specified key does not exist.&lt;/Message&gt;&lt;Key&gt;spaces/658B0ABB-DA53-496D-9FE5-E0631CA5DEF2/C014470D-490A-4201-8934-5E62AF77AFCD/pluginData/882C33F9-B3DA-4E74-A536-D44934485473/default.zip&lt;/Key&gt;&lt;RequestId&gt;2DES3TF5JC5XMVPY&lt;/RequestId&gt;&lt;HostId&gt;JDJOZsOLMYugw4RSbYL9E14L+HkQ7lVGl4fQJhnqj/Rxt2HQE99FLsyVtv81YBcM1cgcyOf1Gac=&lt;/HostId&gt;&lt;/Error&gt;

../src/steamship/utils/signed_urls.py:31: SteamshipError</failure></testcase></testsuite></testsuites>